/*! For license information please see CoCreate-attributes.min.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CoCreate=e():(t.CoCreate=t.CoCreate||{},t.CoCreate.attributes=e())}(this,(function(){return(()=>{"use strict";var t,e={407:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseClassRules=function(t){return t.split(" ").filter((t=>t))},e.getCoCreateStyle=function(t){let e={};return t.forEach((t=>{let[r,i]=t.split(":");e[a(r)]=i})),e},e.setStyleClassIfDif=function(t,{property:e,camelProperty:r,value:i,computedStyles:n}){let a=t.classList,l=new Map;a.forEach((t=>{let[e,r]=t.split(":");r&&l.set(e,r)}));let o=l.get(e);if(i){if(o){if(o!=i)return a.replace(`${e}:${o}`,`${e}:${i}`)}else if(n[r]!=i&&!a.contains(`${e}:${i}`))return a.add(`${e}:${i}`),!0}else if(a.contains(`${e}:${o}`))return a.remove(`${e}:${o}`),!0;return!1},e.setAttributeIfDif=function(t,e){if(this.getAttribute(t)!==e)return e?this.setAttribute(t,e):this.removeAttribute(t),!0;return!1},e.setStyleIfDif=function({property:t,camelProperty:e,value:r,computedStyles:i}){return!(!i[e]||i[e]===r)&&(this.style[t]=r,!0)},e.renderOptions=function(t,e){if(i.container.has(t)){let r=i.container.get(t);e.length?e.forEach((t=>r.selectOption(t))):r.unselectAll(!1)}},e.parseCssRules=function(t){let e={};t.split&&t.split(";").forEach((t=>{let r=t.split(":"),i=r.shift().trim(),n=r.join().trim();i&&(e[i]=n)}));return e},e.rgba2hex=function(t){let e,r=t.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+),?([^,\s)]+)?/i),i=(r&&r[4]||"").trim(),n=r?(256|r[1]).toString(16).slice(1)+(256|r[2]).toString(16).slice(1)+(256|r[3]).toString(16).slice(1):t;e=""!==i?i:1;return e=(255*e|256).toString(16).slice(1),n+=e,n},e.parseUnit=function(t){let e=parseFloat(t);if(isNaN(e))return[t,""];{let r=(e+"").length;return[e,t.substr(r)]}},e.toCamelCase=a,e.elStore=function(){this.cache=new Map,this.spread=function(t,e){this.cache.set(t,{...this.cache.get(t),...e})},this.set=function(t,e,r){this.cache.set(t,{...this.cache.get(t),[e]:r})},this.get=function(t,e){let r=this.cache.get(t);return r?r[e]:void 0},this.reset=function(t){this.cache.delete(t)}};var i=function(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=n(e);if(r&&r.has(t))return r.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var o=a?Object.getOwnPropertyDescriptor(t,l):null;o&&(o.get||o.set)?Object.defineProperty(i,l,o):i[l]=t[l]}i.default=t,r&&r.set(t,i);return i}(r(756));function n(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(n=function(t){return t?r:e})(t)}function a(t){let e=0;for(;;){if(e=t.indexOf("-",e),-1===e)break;{let r=t.substring(0,e);r+=String.fromCharCode(t.charCodeAt(e+1)-32),r+=t.substr(e+2),t=r}}return t}},352:(t,e,r)=>{e.default=void 0;var i=r(407),n=s(r(366)),a=s(r(886)),l=s(r(747)),o=s(r(980)),u=r(602);r(756);function s(t){return t&&t.__esModule?t:{default:t}}let c=new i.elStore,p=["attribute","classstyle","style","innerText"];function f({document:t,exclude:e="",callback:r=(()=>{})}){this.exclude=e,this.callback=r,this.initDocument=t}f.prototype.init=function(){this.scanNewElement(),n.default.init({name:"ccAttribute",observe:["attributes"],attributesFilter:["data-attributes_target","value","data-attributes_unit"],callback:async t=>t.target.matches("INPUT, .pickr, cocreate-select")&&await this.watchInputChange(t)}),this.initDocument.addEventListener("input",(async t=>{let e=t.target;this.perInput(e,((t,r)=>this.updateElement({...t,input:e,element:r,isColl:!0})))})),this.observerElements(this.initDocument.defaultView),o.default.listen("ccStyle",(t=>this.listen(t)))},f.prototype.listen=async function({value:t,unit:e,type:r,property:i,camelProperty:n,elementId:a,elementSelector:l}){let o=i?`[data-attributes="${r}"][data-attributes_property="${i}"]:not(${this.exclude})`:`[data-attributes="${r}"]:not(${this.exclude})`,u=this.initDocument.querySelector(o),s=await this.complexSelector(l,((t,e)=>t.querySelector(e)));this.updateElement({type:r,property:i,camelProperty:n,input:u,element:s,collValue:t,unit:e,isColl:!1})},f.prototype.collaborate=function({element:t,...e}){let r=t.getAttribute("data-element_id");if(!r)return;let i=e.input.getAttribute("data-attributes_target");o.default.send({broadcast_sender:!1,rooms:"",emit:{message:"ccStyle",data:{...e,elementId:r,elementSelector:i}}})},f.prototype.scanNewElement=function(){this.initDocument.querySelectorAll(`[data-attributes]:not(${this.exclude})`).forEach((async t=>{this.perInput(t,((e,r)=>this.updateInput({...e,input:t,element:r,isColl:!0})))}))},f.prototype.observerElements=function(t){t.CoCreate.observer.init({name:"ccAttribute",observe:["attributes"],callback:t=>{let e=t.target;this.getInputFromElement(e).forEach((t=>{let r=this.validateInput(t);r&&this.updateInput({...r,input:t,element:e})}))}})},f.prototype.getInputFromElement=function(t){let e=t.getAttribute("data-element_id")||t.id&&"#"+t.id;return e?this.initDocument.querySelectorAll(`[data-attributes_target="${e}"]`):[]},f.prototype.watchInputChange=async function(t){try{let e,r=t.target,i=this.validateInput(r);if(e=i&&await this.getElementFromInput(r),!e)return;"data-attributes_target"===t.attributeName?this.updateInput({...i,input:r,element:e}):"data-attributes_unit"===t.attributeName&&this.updateElement({...i,input:r,element:e,isColl:!0})}catch(t){}},f.prototype.perInput=async function(t,e){let r,i;r=this.validateInput(t),i=r&&await this.getElementFromInput(t),i&&e(r,i)},f.prototype.validateInput=function(t){let e=t.getAttribute("data-attributes");if(!e)return;e=e.toLowerCase();let r,n=t.getAttribute("data-attributes_property");return n&&(r=(0,i.toCamelCase)(n),n=n.toLowerCase()),{type:e,property:n,camelProperty:r}},f.prototype.updateElementByValue=function({type:t,property:e,camelProperty:r,input:n,element:a,inputValue:l,hasCollValue:o}){let u,s,c;switch(t){case"classstyle":return c=n.getAttribute("data-attributes_unit")||"",s=(l=Array.isArray(l)?l.value:l)&&!o?l+c:l,s=s||"",u=this.getRealStaticCompStyle(a),(0,i.setStyleClassIfDif)(a,{property:e,camelProperty:r,value:s,computedStyles:u});case"style":return c=n.getAttribute("data-attributes_unit")||"",s=(l=Array.isArray(l)?l.value:l)&&!o?l+c:l,s=s||"",u=this.getRealStaticCompStyle(a),i.setStyleIfDif.call(a,{property:e,camelProperty:r,value:s,computedStyles:u});case"innerText":return a.innerText!=l&&(a.innerText=l,!0);default:if("string"==typeof l)return i.setAttributeIfDif.call(a,t,l);if(!l.length)return i.setAttributeIfDif.call(a,t,"");if("class"===t)return s=l.map((t=>t.value)).join(" "),i.setAttributeIfDif.call(a,t,s);for(let e of l)if(e.checked)return i.setAttributeIfDif.call(a,t,e.value)}},f.prototype.removeZeros=function(t){let e=0;for(let r=t.length;e<r&&"0"===t[e];e++);return t.substr(e)||t&&"0"},f.prototype.updateElement=function({input:t,element:e,collValue:r,isColl:i,unit:n,type:a,property:l,...o}){let u=null!=r?r:this.getInputValue(t);if(!u)return;Array.isArray(u)?u.forEach((t=>this.removeZeros(t.value))):(u=n&&u?u+n:u,u=this.removeZeros(u));let s,f=this.updateElementByValue({...o,type:a,property:l,input:t,element:e,inputValue:u,hasCollValue:null!=r});c.reset(e),f&&i&&this.collaborate({value:u,unit:t.getAttribute("data-attributes_unit"),input:t,element:e,type:a,property:l,...o}),p.includes(a)||(l=a,a="attribute"),s=Array.isArray(u)?"class"===l?u.map((t=>t.value)).join(" "):u[0].value:u,f&&i&&this.callback({value:s,unit:t.getAttribute("data-attributes_unit"),input:t,element:e,type:a,property:l,...o})},f.prototype.updateInput=function({type:t,property:e,camelProperty:r,element:n,input:a}){let l,o,u,s,c;if(a){switch(t){case"class":o=Array.from(n.classList);break;case"classstyle":let e=(0,i.getCoCreateStyle)(n.classList);if(e[r]?u=e[r]:(l=this.getRealStaticCompStyle(n),u=l[r]),!u)return;[s,c]=(0,i.parseUnit)(u),o=s,i.setAttributeIfDif.call(a,"data-attributes_unit",c);break;case"style":if(l=this.getRealStaticCompStyle(n),u=l[r],!u)return;[s,c]=(0,i.parseUnit)(u),o=s,i.setAttributeIfDif.call(a,"data-attributes_unit",c);case"innerText":o=n.innerText;break;default:o=n.getAttribute(t)}this.setInputValue(a,null!=o?o:"")}},f.prototype.setInputValue=function(t,e){switch((t.classList.contains("pickr")?"pickr":t.matches(u.containerSelector)&&"cocreate-select")||t.tagName.toLowerCase()){case"select":let r=Array.from(t.options);r.forEach((i=>{e==i.value&&(t.selectedIndex=r.indexOf(i))}));break;case"cocreate-select":e=e?Array.isArray(e)?e:[e]:[],(0,i.renderOptions)(t,e);break;case"pickr":l.default.refs.get(t).setColor(e);break;default:a.default.replaceText({collection:"builder",document_id:"null",name:t.getAttribute("name"),value:e+"",position:"0"})}},f.prototype.packMultiValue=function({inputs:t,stateProperty:e,valueProperty:r="value",forceState:i}){let n=[];return Array.from(t).forEach((t=>{n.push({checked:i||t[e],value:t[r]||t.getAttribute(r)})})),n},f.prototype.getInputValue=function(t){if(!t)return;switch((t.classList.contains("pickr")?"pickr":t.matches(u.containerSelector)&&"cocreate-select")||t.tagName.toLowerCase()){case"input":switch(t.type){case"checkbox":case"radio":return this.packMultiValue({inputs:this.initDocument.getElementsByName(t.name),stateProperty:"checked"});default:return t.value}case"textarea":return t.value;case"select":return this.packMultiValue({inputs:t.options,stateProperty:"selected"});case"cocreate-select":return this.packMultiValue({inputs:t.selectedOptions,forceState:!0});case"pickr":let e=l.default.refs.get(t);return e?e.getColor():"";default:return!1}},f.prototype.getElementFromInput=async function(t){let e=t.getAttribute("data-attributes_target");if(e){if(-1!==e.indexOf(";")){return await this.complexSelector(e,((t,e)=>t.querySelector(e)))}return this.initDocument.querySelector(e)}return!1},f.prototype.getRealStaticCompStyle=function(t){if(c.get(t,"valid"))return c.get(t,"computedStyles");setTimeout((()=>{c.reset(t)}),5e3);let e=t.style.display;t.style.display="none";let r=window.getComputedStyle(t),i=Object.assign({},r);return i.display=e,t.style.display=e,""==t.getAttribute("style")&&t.removeAttribute("style"),t.removeAttribute("no-observe"),c.spread(t,{computedStyles:i,valid:!0}),i};let d=new Map;f.prototype.complexSelector=async function(t,e){let[r,i]=t.split(";"),n=document.querySelector(r);if(n){if("loading"===n.contentDocument.readyState)try{await new Promise(((t,e)=>{n.contentWindow.addEventListener("load",(e=>t()))}))}catch(t){}return n.contentWindow.CoCreate.observer&&!d.has(n.contentWindow)&&(this.observerElements(n.contentWindow),d.set(n.contentWindow)),e(n.contentWindow.document,i)}};var y={init:t=>{let e=new f(t);return e.init(),e}};e.default=y}},r={};function i(t){var n=r[t];if(void 0!==n)return n.exports;var a=r[t]={exports:{}};return e[t].call(a.exports,a,a.exports,i),a.exports}i.m=e,t=[],i.O=(e,r,n,a)=>{if(!r){var l=1/0;for(s=0;s<t.length;s++){for(var[r,n,a]=t[s],o=!0,u=0;u<r.length;u++)(!1&a||l>=a)&&Object.keys(i.O).every((t=>i.O[t](r[u])))?r.splice(u--,1):(o=!1,a<l&&(l=a));o&&(t.splice(s--,1),e=n())}return e}a=a||0;for(var s=t.length;s>0&&t[s-1][2]>a;s--)t[s]=t[s-1];t[s]=[r,n,a]},i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");r.length&&(t=r[r.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),(()=>{var t={722:0};i.O.j=e=>0===t[e];var e=(e,r)=>{var n,a,[l,o,u]=r,s=0;for(n in o)i.o(o,n)&&(i.m[n]=o[n]);if(u)var c=u(i);for(e&&e(r);s<l.length;s++)a=l[s],i.o(t,a)&&t[a]&&t[a][0](),t[l[s]]=0;return i.O(c)},r=this.webpackChunkCoCreate_attributes=this.webpackChunkCoCreate_attributes||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))})();var n=i.O(void 0,[736],(()=>i(352)));return n=(n=i.O(n)).default})()}));