/*! For license information please see text-chunk0ffc363a7380d6b0b270.js.LICENSE.txt */
(this.webpackChunkCoCreate_attributes=this.webpackChunkCoCreate_attributes||[]).push([["text-chunk"],{"../../CoCreateJS/node_modules/@cocreate/text/src/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _cocreate_observer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @cocreate/observer */ \"../../CoCreateJS/node_modules/@cocreate/observer/src/index.js\");\n/* harmony import */ var _cocreate_utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @cocreate/utils */ \"../../CoCreateJS/node_modules/@cocreate/utils/src/index.js\");\n/* harmony import */ var _cocreate_cocreatejs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @cocreate/cocreatejs */ \"../../CoCreateJS/node_modules/@cocreate/cocreatejs/src/index.js\");\n/* harmony import */ var _cocreate_crdt__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @cocreate/crdt */ \"../../CoCreateJS/node_modules/@cocreate/crdt/src/index.js\");\n/* harmony import */ var _cocreate_cursors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @cocreate/cursors */ \"../../CoCreateJS/node_modules/@cocreate/cursors/src/index.js\");\n/* harmony import */ var _cocreate_form__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @cocreate/form */ \"../../CoCreateJS/node_modules/@cocreate/form/src/index.js\");\n/* harmony import */ var _cocreate_floating_label__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @cocreate/floating-label */ \"../../CoCreateJS/node_modules/@cocreate/floating-label/src/index.js\");\n\n\n\n\n\n\n\n\nconst CoCreateText = {\n  elements: [],\n  \n  init : function() {\n    this.initElement(document);\n    // this.initSockets();\n  },\n  \n  refreshElement: function(mutation) {\n    let element = mutation.target;\n    if (!element) return;\n    const tagName = element.tagName.toLowerCase();\n    if (!['input', 'textarea'].includes(tagName) ||\n        !element.getAttribute('data-document_id') ||\n        !element.getAttribute('name')) {\n      return \n    }\n    \n    if (!_cocreate_utils__WEBPACK_IMPORTED_MODULE_1__.default.isUsageY(element)) return;\n    \n    if (!_cocreate_observer__WEBPACK_IMPORTED_MODULE_0__.default.getInitialized(element, 'text')) {\n      this.__initEvents(element);\n    }\n    _cocreate_observer__WEBPACK_IMPORTED_MODULE_0__.default.setInitialized(element, 'text');\n    \n    if (_cocreate_form__WEBPACK_IMPORTED_MODULE_5__.default.checkID(element)) {\n      // element.value = \"\";\n      this.createYDoc(element, true);\n    }\n    \n  },\n  \n  initElement: function(container) {\n    var self = this;\n    let fetch_container = container || document;\n    \n    let elements = fetch_container.querySelectorAll('input[data-document_id][name], textarea[data-document_id][name]');\n    if (elements.length == 0 && \n        fetch_container != document &&\n        fetch_container.hasAttribute('data-document_id') && \n        fetch_container.hasAttribute('name')) \n    {\n      elements = [fetch_container];\n    }\n\n    elements.forEach((element) => {\n      if (!_cocreate_utils__WEBPACK_IMPORTED_MODULE_1__.default.isUsageY(element)) {\n        return;\n      }\n      \n      if (self.checkExistElement(element)) {\n        // this.setInitValue(elements[i])\n        return;\n      }\n      \n\t\t\tif (_cocreate_observer__WEBPACK_IMPORTED_MODULE_0__.default.getInitialized(element, 'text')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t_cocreate_observer__WEBPACK_IMPORTED_MODULE_0__.default.setInitialized(element, 'text');\n      \n      self.__initEvents(element);\n      \n      if (_cocreate_form__WEBPACK_IMPORTED_MODULE_5__.default.checkID(element)) {\n        self.createYDoc(element);\n\n      } else {\n        //. register create document_id event\n        element.addEventListener('set-document_id', function(event) {\n          let el = this;\n          let text_str = el.value;\n          \n          self.createYDoc(el);\n          \n          el.value = \"\";\n          self.sendChangeData(el, text_str, 0, text_str.length);\n        })\n      }\n    })\n  },\n  \n  checkExistElement: function(element) {\n    for (var i = 0; i < this.elements.length; i++) {\n      if (this.elements[i].isSameNode(element)) {\n        return true;\n      }\n    }\n    return false;\n  },\n  \n  setInitValue: function(element) {\n    var typeId = this.generateTypeName(element);\n    var value = _cocreate_crdt__WEBPACK_IMPORTED_MODULE_3__.default.getWholeString(typeId);\n    element.value = value;\n    \n    // input.setValue(element, value);\n  },\n  \n  createYDoc: function(element, isExclude) {\n    const collection = element.getAttribute('data-collection')\n\t\tconst document_id = element.getAttribute('data-document_id')\n\t\tconst name = element.getAttribute('name');\n    const status = _cocreate_crdt__WEBPACK_IMPORTED_MODULE_3__.default.init({\n      collection: collection,\n      document_id: document_id,\n      name: name,\n      element: element,\n    })\n    if (!isExclude) {\n      this.elements.push(element)\n    } else {\n      element.value = _cocreate_crdt__WEBPACK_IMPORTED_MODULE_3__.default.getText({collection, document_id, name })\n      // input.setValue(element, crdt.getText({collection, document_id, name }));\n    }\n  },\n  \n  \n  __initEvents: function(input_element) {\n\n    //. selection event\n    const self = this;\n    \n    input_element.addEventListener('select', function() {\n      if (this.selectionEnd !== this.selectionStart) {\n        self.setSelectionInfo(this, true, this.selectionStart, this.selectionEnd)\n        \n        if(document.activeElement === this)\n          self.sendPosition(this);\n      }\n    });\n    \n    input_element.addEventListener('keyup', function(event) {\n        let arrows = [37,38,39,40];\n        if(arrows.indexOf(event.keyCode)!=-1){\n          self.sendPosition(this);\n        }\n    });\n    \n    input_element.addEventListener('keydown', function(event) {\n        let arrows = [37,38,39,40];\n        if(arrows.indexOf(event.keyCode)!=-1){\n          //console.log(\"keydown ---- \")\n          self.sendPosition(this);\n        }\n    });\n    \n    input_element.addEventListener('click', function(event) {\n        if(document.activeElement === this)\n          self.sendPosition(this);\n    });\n    \n    input_element.addEventListener('blur', function(event) {\n        const id = self.generateTypeName(this);\n        _cocreate_crdt__WEBPACK_IMPORTED_MODULE_3__.default.setCursorNull(id);\n    });\n    \n    input_element.addEventListener('input', function(event) {\n      let nowstart = this.selectionStart - 1;\n      let nowend = nowstart;\n      let selection_info = self.getSelectionInfo(this);\n      let content_text = \"\";\n      let isUpdate = false;      \n      switch (event.inputType) {\n        case 'deleteContentBackward':\n          isUpdate = true;\n          nowstart ++;\n          nowend = nowstart + 1;\n          break;\n        case 'deleteContentForward':\n          isUpdate = true;\n          nowstart ++;\n          nowend = nowstart + 1;\n          break;\n        case 'insertLineBreak':\n          isUpdate = true;\n          content_text = \"\\n\";\n          nowend ++;\n          break;\n        case 'insertText':\n          isUpdate = true;\n          content_text = event.data || \"\\n\";\n          break;\n        case 'deleteByCut':\n          isUpdate = true;\n          break;\n      \n      }\n      \n      if (isUpdate) {\n        if (selection_info.is_selected) {\n          //. delete event\n          let character_deleted = selection_info.start - selection_info.end;\n          \n          //cursors.recalculate_local_cursors(this,character_deleted)\n          \n          self.sendChangeData(this, \"\", selection_info.start, selection_info.end);\n          if (content_text.length > 0) {\n            self.sendChangeData(this, content_text, nowstart, nowend);\n          }\n          self.setSelectionInfo(this, false, this.selectionStart, this.selectionStart);\n        } else {\n          self.sendChangeData(this, content_text, nowstart, nowend);\n        }\n      }\n    })\n\n    /** unselect events **/    \n    input_element.addEventListener('blur', function(e) {\n      self.setSelectionInfo(this, false, this.selectionStart, this.selectionStart);\n    })\n    input_element.addEventListener('click', function(e) {\n      self.setSelectionInfo(this, false, this.selectionStart, this.selectionStart);\n    })\n    \n    /** past events **/\n    input_element.addEventListener('paste', function(event) {\n      let content_text = event.clipboardData.getData('Text');\n      let start = this.selectionStart;\n      let end = this.selectionEnd;\n      //. send delete event\n      if (start != end) {\n        this.setSelectionRange(end, end)\n        self.sendChangeData(this, \"\", start, end, false);\n      }\n      if(start==end){\n        // to calculate Cursors in collaboration \n        // cursors.recalculate_local_cursors(this,content_text.length)\n      }\n      //. insert event\n      self.sendChangeData(this, content_text, start, start, false);\n      event.preventDefault()\n    })\n    \n    input_element.addEventListener('cocreate-y-update', function(event) {\n      var info = event.detail;\n      input_element.crudSetted = true;\n      \n      var pos = 0;\n      var flag = true;\n\n      info.forEach(item => {\n        if (item.retain) {\n          flag = true;\n          pos = item.retain;\n        }\n        \n        if (item.insert || item.delete) {\n          if (flag == false) pos = 0;\n          flag = false;\n          \n          if (item.insert) {\n            //. insert process\n            self.updateChangeData(this, item.insert, pos, pos)\n          } else if (item.delete) {\n            //. delete process\n            self.updateChangeData(this, \"\", pos, pos + item.delete);\n          }\n          \n        }\n      })\n    })\n  },\n\n  setSelectionInfo:function(e, isSelect, start, end) {\n    e.setAttribute(\"is_selected\", isSelect);\n    e.setAttribute(\"selection_start\", start);\n    e.setAttribute(\"selection_end\", end);\n    //console.log(\"swelect\",e)\n    this.sendPosition(e);\n  },\n  \n  getSelectionInfo: function(e) {\n    return {\n      is_selected: (e.getAttribute(\"is_selected\") === 'true') ? true : false,\n      start: parseInt(e.getAttribute(\"selection_start\")),\n      end:parseInt(e.getAttribute(\"selection_end\"))\n    }\n  },\n  \n  checkDocumentID: function(element) {\n    let document_id = element.getAttribute('data-document_id');\n    if (!document_id || document_id === \"\") {\n      return false;\n    }\n    \n    return true;\n  },\n  \n  sendChangeData: function(element, content, start, end, isRemove = true) {\n\n    if (!this.checkDocumentID(element)) {\n      _cocreate_form__WEBPACK_IMPORTED_MODULE_5__.default.request({element: element, nameAttr: \"name\"})\n      element.setAttribute('data-document_id', 'pending');\n      return ;\n    }\n    \n    if (element.getAttribute('data-document_id') == 'pending') {\n      return;\n    }\n    \n    const collection = element.getAttribute('data-collection'),\n          document_id = element.getAttribute('data-document_id'),\n          name = element.getAttribute('name');\n    \n    if (element.getAttribute('data-save_value') == 'false') {\n      return;\n    }\n    //console.log(\"SendChangeDataFrom Cocreate-Text\")\n    let character_count = content.length > 0 ? content.length : -1;\n    _cocreate_cursors__WEBPACK_IMPORTED_MODULE_4__.default.recalculate_local_cursors(element,character_count);\n    \n      //send position when keyUp \n    this.sendPosition(element)\n    if (content.length > 0) {\n      if (isRemove)  {\n        element.setRangeText(\"\", start, start + content.length, \"start\")\n      }\n      _cocreate_crdt__WEBPACK_IMPORTED_MODULE_3__.default.insertText({\n        collection, document_id, name,\n        value: content,\n        position: start\n      })\n    } else {\n      if (isRemove) element.setRangeText(\" \".repeat(end - start), start, start, \"end\")\n      _cocreate_crdt__WEBPACK_IMPORTED_MODULE_3__.default.deleteText({\n        collection, document_id, name,\n        position: start,\n        length: end - start,\n      })\n    }\n    if(document.activeElement === element){\n      this.setSelectionInfo(element, false, element.selectionStart, element.selectionStart);\n      this.sendPosition(element);\n    }\n  },\n\n  updateChangeData: function(element, content, start, end) {\n\n    let prev_start = element.selectionStart;\n    let prev_end = element.selectionEnd;\n    element.setRangeText(content, start, end, \"end\");\n\n    if (prev_start >= start) {\n      if (content == \"\") {\n        prev_start -= end - start;\n        prev_end -= end - start;\n        prev_start = prev_start < start ? start : prev_start;\n      } else {\n        prev_start += content.length;\n        prev_end += content.length;\n      }\n    } {\n      if (content == \"\" && prev_end >= start) {\n        prev_end = (prev_end >= end) ? prev_end - (end - start) : start\n      } \n    }\n    \n    element.selectionStart = prev_start;\n    element.selectionEnd = prev_end;\n\n    var isFocused = (document.activeElement === element);\n    _cocreate_cursors__WEBPACK_IMPORTED_MODULE_4__.default.refresh_mirror(element);\n    \n    if (_cocreate_floating_label__WEBPACK_IMPORTED_MODULE_6__.default)   {\n      _cocreate_floating_label__WEBPACK_IMPORTED_MODULE_6__.default.update(element, element.value)\n    }\n\n  },\n  \n  generateTypeName: function(element) {\n    var collection = element.getAttribute('data-collection');\n    var document_id = element.getAttribute('data-document_id');\n    var name = element.getAttribute('name');\n    \n    return _cocreate_crdt__WEBPACK_IMPORTED_MODULE_3__.default.generateID(config.organization_Id, collection, document_id, name);\n  },\n  \n  setText: function(element_id, info) {\n    var pos = 0;\n    var flag = true;\n    \n    info.forEach(item => {\n      if (item.retain) {\n        flag = true;\n        pos = item.retain;\n      }\n      \n      if (item.insert || item.delete) {\n        if (flag == false) pos = 0;\n        flag = false;\n        \n        if (item.insert) {\n          //. insert process\n          this.receiveChangeData(element_id, item.insert, pos, pos)\n        } else if (item.delete) {\n          //. delete process\n          this.receiveChangeData(element_id, \"\", pos, pos + item.delete);\n        }\n        \n      }\n    })\n  },\n  \n  isAvaiableEl: function(element) {\n    //console.log(this.elements)\n    \n    for (var  i = 0; i < this.elements.length; i++) {\n      console.log(this.elements[i].isEqualNode(element),element)\n      if (this.elements[i].isEqualNode(element)===true) {\n        return true;\n      }\n    }\n    return false;\n  },\n  \n  sendPosition: function(element) {\n    //console.log(\"Se envio \")\n    /*if (!this.isAvaiableEl(element)) {\n      return;\n    }*/\n    \n    const id = this.generateTypeName(element);\n    //console.log(\" SEnd Position Selector ID \",id)\n    //console.log(element.selectionStart, element.selectionEnd);\n    let from = element.selectionStart;\n    let to = element.selectionEnd;\n    //console.log(\"Se envio la position \",id,from, to)\n    _cocreate_crdt__WEBPACK_IMPORTED_MODULE_3__.default.setPositionYJS(id, from, to);\n    \n  }\n}\n\n\nCoCreateText.init();\n// CoCreateInit.register('CoCreateText', CoCreateText, CoCreateText.initElement);\n\n_cocreate_observer__WEBPACK_IMPORTED_MODULE_0__.default.init({ \n\tname: 'CoCreateTextCreate', \n\tobserve: ['subtree', 'childList'],\n\tinclude: '[data-collection][data-document_id][name]', \n\tcallback: function(mutation) {\n\t  console.log('cocreate-text init')\n\t\tCoCreateText.initElement(mutation.target)\n\t}\n});\n\n_cocreate_observer__WEBPACK_IMPORTED_MODULE_0__.default.init({ \n\tname: 'CoCreateTextNameObserver', \n\tobserve: ['attributes'],\n\tattributes: ['name'],\n\tcallback: function(mutation) {\n\t\tconsole.log('change cocreate-text name')\n\t\tCoCreateText.refreshElement(mutation)\n\t}\n});\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (CoCreateText);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Db0NyZWF0ZS5hdHRyaWJ1dGVzLy4uLy4uL0NvQ3JlYXRlSlMvbm9kZV9tb2R1bGVzL0Bjb2NyZWF0ZS90ZXh0L3NyYy9pbmRleC5qcz82N2E4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQXlDO0FBQ0g7QUFDWTtBQUNqQjtBQUNNO0FBQ047QUFDbUI7O0FBRXBEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsU0FBUyw2REFBZ0I7O0FBRXpCLFNBQVMsc0VBQXVCO0FBQ2hDO0FBQ0E7QUFDQSxJQUFJLHNFQUF1Qjs7QUFFM0IsUUFBUSwyREFBWTtBQUNwQjtBQUNBO0FBQ0E7O0FBRUEsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFdBQVcsNkRBQWdCO0FBQzNCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBTyxzRUFBdUI7QUFDOUI7QUFDQTtBQUNBLEdBQUcsc0VBQXVCOztBQUUxQjs7QUFFQSxVQUFVLDJEQUFZO0FBQ3RCOztBQUVBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsS0FBSztBQUNMLEdBQUc7O0FBRUg7QUFDQSxtQkFBbUIsMEJBQTBCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQSxnQkFBZ0Isa0VBQW1CO0FBQ25DOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQix3REFBUztBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMLHNCQUFzQiwyREFBWSxFQUFFLCtCQUErQjtBQUNuRSwrQ0FBK0MsK0JBQStCO0FBQzlFO0FBQ0EsR0FBRzs7O0FBR0g7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLFFBQVEsaUVBQWtCO0FBQzFCLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0EsTUFBTSwyREFBWSxFQUFFLG1DQUFtQztBQUN2RDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSxnRkFBaUM7O0FBRXJDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sOERBQWU7QUFDckI7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBLE1BQU0sOERBQWU7QUFDckI7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsTztBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJLHFFQUFzQjs7QUFFMUIsUUFBUSw2REFBYTtBQUNyQixNQUFNLG9FQUFvQjtBQUMxQjs7QUFFQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFdBQVcsOERBQWU7QUFDMUIsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEtBQUs7QUFDTCxHQUFHOztBQUVIO0FBQ0E7O0FBRUEsb0JBQW9CLDBCQUEwQjtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLGtFQUFtQjs7QUFFdkI7QUFDQTs7O0FBR0E7QUFDQTs7QUFFQSw0REFBYSxFO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVELDREQUFhLEU7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQsaUVBQWUsWUFBWSIsImZpbGUiOiIuLi8uLi9Db0NyZWF0ZUpTL25vZGVfbW9kdWxlcy9AY29jcmVhdGUvdGV4dC9zcmMvaW5kZXguanMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgb2JzZXJ2ZXIgZnJvbSAnQGNvY3JlYXRlL29ic2VydmVyJ1xuaW1wb3J0IGNjdXRpbHMgZnJvbSAnQGNvY3JlYXRlL3V0aWxzJztcbmltcG9ydCB7c29ja2V0LCBjcnVkfSBmcm9tICdAY29jcmVhdGUvY29jcmVhdGVqcyc7XG5pbXBvcnQgY3JkdCBmcm9tICdAY29jcmVhdGUvY3JkdCdcbmltcG9ydCBjdXJzb3JzIGZyb20gJ0Bjb2NyZWF0ZS9jdXJzb3JzJ1xuaW1wb3J0IGZvcm0gZnJvbSAnQGNvY3JlYXRlL2Zvcm0nXG5pbXBvcnQgZmxvYXRpbmdMYWJlbCBmcm9tICdAY29jcmVhdGUvZmxvYXRpbmctbGFiZWwnXG5cbmNvbnN0IENvQ3JlYXRlVGV4dCA9IHtcbiAgZWxlbWVudHM6IFtdLFxuICBcbiAgaW5pdCA6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuaW5pdEVsZW1lbnQoZG9jdW1lbnQpO1xuICAgIC8vIHRoaXMuaW5pdFNvY2tldHMoKTtcbiAgfSxcbiAgXG4gIHJlZnJlc2hFbGVtZW50OiBmdW5jdGlvbihtdXRhdGlvbikge1xuICAgIGxldCBlbGVtZW50ID0gbXV0YXRpb24udGFyZ2V0O1xuICAgIGlmICghZWxlbWVudCkgcmV0dXJuO1xuICAgIGNvbnN0IHRhZ05hbWUgPSBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoIVsnaW5wdXQnLCAndGV4dGFyZWEnXS5pbmNsdWRlcyh0YWdOYW1lKSB8fFxuICAgICAgICAhZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtZG9jdW1lbnRfaWQnKSB8fFxuICAgICAgICAhZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ25hbWUnKSkge1xuICAgICAgcmV0dXJuIFxuICAgIH1cbiAgICBcbiAgICBpZiAoIWNjdXRpbHMuaXNVc2FnZVkoZWxlbWVudCkpIHJldHVybjtcbiAgICBcbiAgICBpZiAoIW9ic2VydmVyLmdldEluaXRpYWxpemVkKGVsZW1lbnQsICd0ZXh0JykpIHtcbiAgICAgIHRoaXMuX19pbml0RXZlbnRzKGVsZW1lbnQpO1xuICAgIH1cbiAgICBvYnNlcnZlci5zZXRJbml0aWFsaXplZChlbGVtZW50LCAndGV4dCcpO1xuICAgIFxuICAgIGlmIChmb3JtLmNoZWNrSUQoZWxlbWVudCkpIHtcbiAgICAgIC8vIGVsZW1lbnQudmFsdWUgPSBcIlwiO1xuICAgICAgdGhpcy5jcmVhdGVZRG9jKGVsZW1lbnQsIHRydWUpO1xuICAgIH1cbiAgICBcbiAgfSxcbiAgXG4gIGluaXRFbGVtZW50OiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgbGV0IGZldGNoX2NvbnRhaW5lciA9IGNvbnRhaW5lciB8fCBkb2N1bWVudDtcbiAgICBcbiAgICBsZXQgZWxlbWVudHMgPSBmZXRjaF9jb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbZGF0YS1kb2N1bWVudF9pZF1bbmFtZV0sIHRleHRhcmVhW2RhdGEtZG9jdW1lbnRfaWRdW25hbWVdJyk7XG4gICAgaWYgKGVsZW1lbnRzLmxlbmd0aCA9PSAwICYmIFxuICAgICAgICBmZXRjaF9jb250YWluZXIgIT0gZG9jdW1lbnQgJiZcbiAgICAgICAgZmV0Y2hfY29udGFpbmVyLmhhc0F0dHJpYnV0ZSgnZGF0YS1kb2N1bWVudF9pZCcpICYmIFxuICAgICAgICBmZXRjaF9jb250YWluZXIuaGFzQXR0cmlidXRlKCduYW1lJykpIFxuICAgIHtcbiAgICAgIGVsZW1lbnRzID0gW2ZldGNoX2NvbnRhaW5lcl07XG4gICAgfVxuXG4gICAgZWxlbWVudHMuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgaWYgKCFjY3V0aWxzLmlzVXNhZ2VZKGVsZW1lbnQpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKHNlbGYuY2hlY2tFeGlzdEVsZW1lbnQoZWxlbWVudCkpIHtcbiAgICAgICAgLy8gdGhpcy5zZXRJbml0VmFsdWUoZWxlbWVudHNbaV0pXG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIFxuXHRcdFx0aWYgKG9ic2VydmVyLmdldEluaXRpYWxpemVkKGVsZW1lbnQsICd0ZXh0JykpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0b2JzZXJ2ZXIuc2V0SW5pdGlhbGl6ZWQoZWxlbWVudCwgJ3RleHQnKTtcbiAgICAgIFxuICAgICAgc2VsZi5fX2luaXRFdmVudHMoZWxlbWVudCk7XG4gICAgICBcbiAgICAgIGlmIChmb3JtLmNoZWNrSUQoZWxlbWVudCkpIHtcbiAgICAgICAgc2VsZi5jcmVhdGVZRG9jKGVsZW1lbnQpO1xuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLy4gcmVnaXN0ZXIgY3JlYXRlIGRvY3VtZW50X2lkIGV2ZW50XG4gICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2V0LWRvY3VtZW50X2lkJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICBsZXQgZWwgPSB0aGlzO1xuICAgICAgICAgIGxldCB0ZXh0X3N0ciA9IGVsLnZhbHVlO1xuICAgICAgICAgIFxuICAgICAgICAgIHNlbGYuY3JlYXRlWURvYyhlbCk7XG4gICAgICAgICAgXG4gICAgICAgICAgZWwudmFsdWUgPSBcIlwiO1xuICAgICAgICAgIHNlbGYuc2VuZENoYW5nZURhdGEoZWwsIHRleHRfc3RyLCAwLCB0ZXh0X3N0ci5sZW5ndGgpO1xuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0pXG4gIH0sXG4gIFxuICBjaGVja0V4aXN0RWxlbWVudDogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5lbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKHRoaXMuZWxlbWVudHNbaV0uaXNTYW1lTm9kZShlbGVtZW50KSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBcbiAgc2V0SW5pdFZhbHVlOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgdmFyIHR5cGVJZCA9IHRoaXMuZ2VuZXJhdGVUeXBlTmFtZShlbGVtZW50KTtcbiAgICB2YXIgdmFsdWUgPSBjcmR0LmdldFdob2xlU3RyaW5nKHR5cGVJZCk7XG4gICAgZWxlbWVudC52YWx1ZSA9IHZhbHVlO1xuICAgIFxuICAgIC8vIGlucHV0LnNldFZhbHVlKGVsZW1lbnQsIHZhbHVlKTtcbiAgfSxcbiAgXG4gIGNyZWF0ZVlEb2M6IGZ1bmN0aW9uKGVsZW1lbnQsIGlzRXhjbHVkZSkge1xuICAgIGNvbnN0IGNvbGxlY3Rpb24gPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1jb2xsZWN0aW9uJylcblx0XHRjb25zdCBkb2N1bWVudF9pZCA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWRvY3VtZW50X2lkJylcblx0XHRjb25zdCBuYW1lID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ25hbWUnKTtcbiAgICBjb25zdCBzdGF0dXMgPSBjcmR0LmluaXQoe1xuICAgICAgY29sbGVjdGlvbjogY29sbGVjdGlvbixcbiAgICAgIGRvY3VtZW50X2lkOiBkb2N1bWVudF9pZCxcbiAgICAgIG5hbWU6IG5hbWUsXG4gICAgICBlbGVtZW50OiBlbGVtZW50LFxuICAgIH0pXG4gICAgaWYgKCFpc0V4Y2x1ZGUpIHtcbiAgICAgIHRoaXMuZWxlbWVudHMucHVzaChlbGVtZW50KVxuICAgIH0gZWxzZSB7XG4gICAgICBlbGVtZW50LnZhbHVlID0gY3JkdC5nZXRUZXh0KHtjb2xsZWN0aW9uLCBkb2N1bWVudF9pZCwgbmFtZSB9KVxuICAgICAgLy8gaW5wdXQuc2V0VmFsdWUoZWxlbWVudCwgY3JkdC5nZXRUZXh0KHtjb2xsZWN0aW9uLCBkb2N1bWVudF9pZCwgbmFtZSB9KSk7XG4gICAgfVxuICB9LFxuICBcbiAgXG4gIF9faW5pdEV2ZW50czogZnVuY3Rpb24oaW5wdXRfZWxlbWVudCkge1xuXG4gICAgLy8uIHNlbGVjdGlvbiBldmVudFxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIFxuICAgIGlucHV0X2VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2VsZWN0JywgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy5zZWxlY3Rpb25FbmQgIT09IHRoaXMuc2VsZWN0aW9uU3RhcnQpIHtcbiAgICAgICAgc2VsZi5zZXRTZWxlY3Rpb25JbmZvKHRoaXMsIHRydWUsIHRoaXMuc2VsZWN0aW9uU3RhcnQsIHRoaXMuc2VsZWN0aW9uRW5kKVxuICAgICAgICBcbiAgICAgICAgaWYoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9PT0gdGhpcylcbiAgICAgICAgICBzZWxmLnNlbmRQb3NpdGlvbih0aGlzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICBpbnB1dF9lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgbGV0IGFycm93cyA9IFszNywzOCwzOSw0MF07XG4gICAgICAgIGlmKGFycm93cy5pbmRleE9mKGV2ZW50LmtleUNvZGUpIT0tMSl7XG4gICAgICAgICAgc2VsZi5zZW5kUG9zaXRpb24odGhpcyk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICBpbnB1dF9lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBsZXQgYXJyb3dzID0gWzM3LDM4LDM5LDQwXTtcbiAgICAgICAgaWYoYXJyb3dzLmluZGV4T2YoZXZlbnQua2V5Q29kZSkhPS0xKXtcbiAgICAgICAgICAvL2NvbnNvbGUubG9nKFwia2V5ZG93biAtLS0tIFwiKVxuICAgICAgICAgIHNlbGYuc2VuZFBvc2l0aW9uKHRoaXMpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgXG4gICAgaW5wdXRfZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGlmKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IHRoaXMpXG4gICAgICAgICAgc2VsZi5zZW5kUG9zaXRpb24odGhpcyk7XG4gICAgfSk7XG4gICAgXG4gICAgaW5wdXRfZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgY29uc3QgaWQgPSBzZWxmLmdlbmVyYXRlVHlwZU5hbWUodGhpcyk7XG4gICAgICAgIGNyZHQuc2V0Q3Vyc29yTnVsbChpZCk7XG4gICAgfSk7XG4gICAgXG4gICAgaW5wdXRfZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICBsZXQgbm93c3RhcnQgPSB0aGlzLnNlbGVjdGlvblN0YXJ0IC0gMTtcbiAgICAgIGxldCBub3dlbmQgPSBub3dzdGFydDtcbiAgICAgIGxldCBzZWxlY3Rpb25faW5mbyA9IHNlbGYuZ2V0U2VsZWN0aW9uSW5mbyh0aGlzKTtcbiAgICAgIGxldCBjb250ZW50X3RleHQgPSBcIlwiO1xuICAgICAgbGV0IGlzVXBkYXRlID0gZmFsc2U7ICAgICAgXG4gICAgICBzd2l0Y2ggKGV2ZW50LmlucHV0VHlwZSkge1xuICAgICAgICBjYXNlICdkZWxldGVDb250ZW50QmFja3dhcmQnOlxuICAgICAgICAgIGlzVXBkYXRlID0gdHJ1ZTtcbiAgICAgICAgICBub3dzdGFydCArKztcbiAgICAgICAgICBub3dlbmQgPSBub3dzdGFydCArIDE7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2RlbGV0ZUNvbnRlbnRGb3J3YXJkJzpcbiAgICAgICAgICBpc1VwZGF0ZSA9IHRydWU7XG4gICAgICAgICAgbm93c3RhcnQgKys7XG4gICAgICAgICAgbm93ZW5kID0gbm93c3RhcnQgKyAxO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdpbnNlcnRMaW5lQnJlYWsnOlxuICAgICAgICAgIGlzVXBkYXRlID0gdHJ1ZTtcbiAgICAgICAgICBjb250ZW50X3RleHQgPSBcIlxcblwiO1xuICAgICAgICAgIG5vd2VuZCArKztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnaW5zZXJ0VGV4dCc6XG4gICAgICAgICAgaXNVcGRhdGUgPSB0cnVlO1xuICAgICAgICAgIGNvbnRlbnRfdGV4dCA9IGV2ZW50LmRhdGEgfHwgXCJcXG5cIjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnZGVsZXRlQnlDdXQnOlxuICAgICAgICAgIGlzVXBkYXRlID0gdHJ1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIFxuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAoaXNVcGRhdGUpIHtcbiAgICAgICAgaWYgKHNlbGVjdGlvbl9pbmZvLmlzX3NlbGVjdGVkKSB7XG4gICAgICAgICAgLy8uIGRlbGV0ZSBldmVudFxuICAgICAgICAgIGxldCBjaGFyYWN0ZXJfZGVsZXRlZCA9IHNlbGVjdGlvbl9pbmZvLnN0YXJ0IC0gc2VsZWN0aW9uX2luZm8uZW5kO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vY3Vyc29ycy5yZWNhbGN1bGF0ZV9sb2NhbF9jdXJzb3JzKHRoaXMsY2hhcmFjdGVyX2RlbGV0ZWQpXG4gICAgICAgICAgXG4gICAgICAgICAgc2VsZi5zZW5kQ2hhbmdlRGF0YSh0aGlzLCBcIlwiLCBzZWxlY3Rpb25faW5mby5zdGFydCwgc2VsZWN0aW9uX2luZm8uZW5kKTtcbiAgICAgICAgICBpZiAoY29udGVudF90ZXh0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHNlbGYuc2VuZENoYW5nZURhdGEodGhpcywgY29udGVudF90ZXh0LCBub3dzdGFydCwgbm93ZW5kKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgc2VsZi5zZXRTZWxlY3Rpb25JbmZvKHRoaXMsIGZhbHNlLCB0aGlzLnNlbGVjdGlvblN0YXJ0LCB0aGlzLnNlbGVjdGlvblN0YXJ0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZWxmLnNlbmRDaGFuZ2VEYXRhKHRoaXMsIGNvbnRlbnRfdGV4dCwgbm93c3RhcnQsIG5vd2VuZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuXG4gICAgLyoqIHVuc2VsZWN0IGV2ZW50cyAqKi8gICAgXG4gICAgaW5wdXRfZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24oZSkge1xuICAgICAgc2VsZi5zZXRTZWxlY3Rpb25JbmZvKHRoaXMsIGZhbHNlLCB0aGlzLnNlbGVjdGlvblN0YXJ0LCB0aGlzLnNlbGVjdGlvblN0YXJ0KTtcbiAgICB9KVxuICAgIGlucHV0X2VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICBzZWxmLnNldFNlbGVjdGlvbkluZm8odGhpcywgZmFsc2UsIHRoaXMuc2VsZWN0aW9uU3RhcnQsIHRoaXMuc2VsZWN0aW9uU3RhcnQpO1xuICAgIH0pXG4gICAgXG4gICAgLyoqIHBhc3QgZXZlbnRzICoqL1xuICAgIGlucHV0X2VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncGFzdGUnLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgbGV0IGNvbnRlbnRfdGV4dCA9IGV2ZW50LmNsaXBib2FyZERhdGEuZ2V0RGF0YSgnVGV4dCcpO1xuICAgICAgbGV0IHN0YXJ0ID0gdGhpcy5zZWxlY3Rpb25TdGFydDtcbiAgICAgIGxldCBlbmQgPSB0aGlzLnNlbGVjdGlvbkVuZDtcbiAgICAgIC8vLiBzZW5kIGRlbGV0ZSBldmVudFxuICAgICAgaWYgKHN0YXJ0ICE9IGVuZCkge1xuICAgICAgICB0aGlzLnNldFNlbGVjdGlvblJhbmdlKGVuZCwgZW5kKVxuICAgICAgICBzZWxmLnNlbmRDaGFuZ2VEYXRhKHRoaXMsIFwiXCIsIHN0YXJ0LCBlbmQsIGZhbHNlKTtcbiAgICAgIH1cbiAgICAgIGlmKHN0YXJ0PT1lbmQpe1xuICAgICAgICAvLyB0byBjYWxjdWxhdGUgQ3Vyc29ycyBpbiBjb2xsYWJvcmF0aW9uIFxuICAgICAgICAvLyBjdXJzb3JzLnJlY2FsY3VsYXRlX2xvY2FsX2N1cnNvcnModGhpcyxjb250ZW50X3RleHQubGVuZ3RoKVxuICAgICAgfVxuICAgICAgLy8uIGluc2VydCBldmVudFxuICAgICAgc2VsZi5zZW5kQ2hhbmdlRGF0YSh0aGlzLCBjb250ZW50X3RleHQsIHN0YXJ0LCBzdGFydCwgZmFsc2UpO1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgIH0pXG4gICAgXG4gICAgaW5wdXRfZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjb2NyZWF0ZS15LXVwZGF0ZScsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICB2YXIgaW5mbyA9IGV2ZW50LmRldGFpbDtcbiAgICAgIGlucHV0X2VsZW1lbnQuY3J1ZFNldHRlZCA9IHRydWU7XG4gICAgICBcbiAgICAgIHZhciBwb3MgPSAwO1xuICAgICAgdmFyIGZsYWcgPSB0cnVlO1xuXG4gICAgICBpbmZvLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGlmIChpdGVtLnJldGFpbikge1xuICAgICAgICAgIGZsYWcgPSB0cnVlO1xuICAgICAgICAgIHBvcyA9IGl0ZW0ucmV0YWluO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAoaXRlbS5pbnNlcnQgfHwgaXRlbS5kZWxldGUpIHtcbiAgICAgICAgICBpZiAoZmxhZyA9PSBmYWxzZSkgcG9zID0gMDtcbiAgICAgICAgICBmbGFnID0gZmFsc2U7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKGl0ZW0uaW5zZXJ0KSB7XG4gICAgICAgICAgICAvLy4gaW5zZXJ0IHByb2Nlc3NcbiAgICAgICAgICAgIHNlbGYudXBkYXRlQ2hhbmdlRGF0YSh0aGlzLCBpdGVtLmluc2VydCwgcG9zLCBwb3MpXG4gICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmRlbGV0ZSkge1xuICAgICAgICAgICAgLy8uIGRlbGV0ZSBwcm9jZXNzXG4gICAgICAgICAgICBzZWxmLnVwZGF0ZUNoYW5nZURhdGEodGhpcywgXCJcIiwgcG9zLCBwb3MgKyBpdGVtLmRlbGV0ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0pXG4gIH0sXG5cbiAgc2V0U2VsZWN0aW9uSW5mbzpmdW5jdGlvbihlLCBpc1NlbGVjdCwgc3RhcnQsIGVuZCkge1xuICAgIGUuc2V0QXR0cmlidXRlKFwiaXNfc2VsZWN0ZWRcIiwgaXNTZWxlY3QpO1xuICAgIGUuc2V0QXR0cmlidXRlKFwic2VsZWN0aW9uX3N0YXJ0XCIsIHN0YXJ0KTtcbiAgICBlLnNldEF0dHJpYnV0ZShcInNlbGVjdGlvbl9lbmRcIiwgZW5kKTtcbiAgICAvL2NvbnNvbGUubG9nKFwic3dlbGVjdFwiLGUpXG4gICAgdGhpcy5zZW5kUG9zaXRpb24oZSk7XG4gIH0sXG4gIFxuICBnZXRTZWxlY3Rpb25JbmZvOiBmdW5jdGlvbihlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlzX3NlbGVjdGVkOiAoZS5nZXRBdHRyaWJ1dGUoXCJpc19zZWxlY3RlZFwiKSA9PT0gJ3RydWUnKSA/IHRydWUgOiBmYWxzZSxcbiAgICAgIHN0YXJ0OiBwYXJzZUludChlLmdldEF0dHJpYnV0ZShcInNlbGVjdGlvbl9zdGFydFwiKSksXG4gICAgICBlbmQ6cGFyc2VJbnQoZS5nZXRBdHRyaWJ1dGUoXCJzZWxlY3Rpb25fZW5kXCIpKVxuICAgIH1cbiAgfSxcbiAgXG4gIGNoZWNrRG9jdW1lbnRJRDogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIGxldCBkb2N1bWVudF9pZCA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWRvY3VtZW50X2lkJyk7XG4gICAgaWYgKCFkb2N1bWVudF9pZCB8fCBkb2N1bWVudF9pZCA9PT0gXCJcIikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSxcbiAgXG4gIHNlbmRDaGFuZ2VEYXRhOiBmdW5jdGlvbihlbGVtZW50LCBjb250ZW50LCBzdGFydCwgZW5kLCBpc1JlbW92ZSA9IHRydWUpIHtcblxuICAgIGlmICghdGhpcy5jaGVja0RvY3VtZW50SUQoZWxlbWVudCkpIHtcbiAgICAgIGZvcm0ucmVxdWVzdCh7ZWxlbWVudDogZWxlbWVudCwgbmFtZUF0dHI6IFwibmFtZVwifSlcbiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLWRvY3VtZW50X2lkJywgJ3BlbmRpbmcnKTtcbiAgICAgIHJldHVybiA7XG4gICAgfVxuICAgIFxuICAgIGlmIChlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1kb2N1bWVudF9pZCcpID09ICdwZW5kaW5nJykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBjb2xsZWN0aW9uID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY29sbGVjdGlvbicpLFxuICAgICAgICAgIGRvY3VtZW50X2lkID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtZG9jdW1lbnRfaWQnKSxcbiAgICAgICAgICBuYW1lID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ25hbWUnKTtcbiAgICBcbiAgICBpZiAoZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtc2F2ZV92YWx1ZScpID09ICdmYWxzZScpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy9jb25zb2xlLmxvZyhcIlNlbmRDaGFuZ2VEYXRhRnJvbSBDb2NyZWF0ZS1UZXh0XCIpXG4gICAgbGV0IGNoYXJhY3Rlcl9jb3VudCA9IGNvbnRlbnQubGVuZ3RoID4gMCA/IGNvbnRlbnQubGVuZ3RoIDogLTE7XG4gICAgY3Vyc29ycy5yZWNhbGN1bGF0ZV9sb2NhbF9jdXJzb3JzKGVsZW1lbnQsY2hhcmFjdGVyX2NvdW50KTtcbiAgICBcbiAgICAgIC8vc2VuZCBwb3NpdGlvbiB3aGVuIGtleVVwIFxuICAgIHRoaXMuc2VuZFBvc2l0aW9uKGVsZW1lbnQpXG4gICAgaWYgKGNvbnRlbnQubGVuZ3RoID4gMCkge1xuICAgICAgaWYgKGlzUmVtb3ZlKSAge1xuICAgICAgICBlbGVtZW50LnNldFJhbmdlVGV4dChcIlwiLCBzdGFydCwgc3RhcnQgKyBjb250ZW50Lmxlbmd0aCwgXCJzdGFydFwiKVxuICAgICAgfVxuICAgICAgY3JkdC5pbnNlcnRUZXh0KHtcbiAgICAgICAgY29sbGVjdGlvbiwgZG9jdW1lbnRfaWQsIG5hbWUsXG4gICAgICAgIHZhbHVlOiBjb250ZW50LFxuICAgICAgICBwb3NpdGlvbjogc3RhcnRcbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChpc1JlbW92ZSkgZWxlbWVudC5zZXRSYW5nZVRleHQoXCIgXCIucmVwZWF0KGVuZCAtIHN0YXJ0KSwgc3RhcnQsIHN0YXJ0LCBcImVuZFwiKVxuICAgICAgY3JkdC5kZWxldGVUZXh0KHtcbiAgICAgICAgY29sbGVjdGlvbiwgZG9jdW1lbnRfaWQsIG5hbWUsXG4gICAgICAgIHBvc2l0aW9uOiBzdGFydCxcbiAgICAgICAgbGVuZ3RoOiBlbmQgLSBzdGFydCxcbiAgICAgIH0pXG4gICAgfVxuICAgIGlmKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IGVsZW1lbnQpe1xuICAgICAgdGhpcy5zZXRTZWxlY3Rpb25JbmZvKGVsZW1lbnQsIGZhbHNlLCBlbGVtZW50LnNlbGVjdGlvblN0YXJ0LCBlbGVtZW50LnNlbGVjdGlvblN0YXJ0KTtcbiAgICAgIHRoaXMuc2VuZFBvc2l0aW9uKGVsZW1lbnQpO1xuICAgIH1cbiAgfSxcblxuICB1cGRhdGVDaGFuZ2VEYXRhOiBmdW5jdGlvbihlbGVtZW50LCBjb250ZW50LCBzdGFydCwgZW5kKSB7XG5cbiAgICBsZXQgcHJldl9zdGFydCA9IGVsZW1lbnQuc2VsZWN0aW9uU3RhcnQ7XG4gICAgbGV0IHByZXZfZW5kID0gZWxlbWVudC5zZWxlY3Rpb25FbmQ7XG4gICAgZWxlbWVudC5zZXRSYW5nZVRleHQoY29udGVudCwgc3RhcnQsIGVuZCwgXCJlbmRcIik7XG5cbiAgICBpZiAocHJldl9zdGFydCA+PSBzdGFydCkge1xuICAgICAgaWYgKGNvbnRlbnQgPT0gXCJcIikge1xuICAgICAgICBwcmV2X3N0YXJ0IC09IGVuZCAtIHN0YXJ0O1xuICAgICAgICBwcmV2X2VuZCAtPSBlbmQgLSBzdGFydDtcbiAgICAgICAgcHJldl9zdGFydCA9IHByZXZfc3RhcnQgPCBzdGFydCA/IHN0YXJ0IDogcHJldl9zdGFydDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHByZXZfc3RhcnQgKz0gY29udGVudC5sZW5ndGg7XG4gICAgICAgIHByZXZfZW5kICs9IGNvbnRlbnQubGVuZ3RoO1xuICAgICAgfVxuICAgIH0ge1xuICAgICAgaWYgKGNvbnRlbnQgPT0gXCJcIiAmJiBwcmV2X2VuZCA+PSBzdGFydCkge1xuICAgICAgICBwcmV2X2VuZCA9IChwcmV2X2VuZCA+PSBlbmQpID8gcHJldl9lbmQgLSAoZW5kIC0gc3RhcnQpIDogc3RhcnRcbiAgICAgIH0gXG4gICAgfVxuICAgIFxuICAgIGVsZW1lbnQuc2VsZWN0aW9uU3RhcnQgPSBwcmV2X3N0YXJ0O1xuICAgIGVsZW1lbnQuc2VsZWN0aW9uRW5kID0gcHJldl9lbmQ7XG5cbiAgICB2YXIgaXNGb2N1c2VkID0gKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IGVsZW1lbnQpO1xuICAgIGN1cnNvcnMucmVmcmVzaF9taXJyb3IoZWxlbWVudCk7XG4gICAgXG4gICAgaWYgKGZsb2F0aW5nTGFiZWwpICAge1xuICAgICAgZmxvYXRpbmdMYWJlbC51cGRhdGUoZWxlbWVudCwgZWxlbWVudC52YWx1ZSlcbiAgICB9XG5cbiAgfSxcbiAgXG4gIGdlbmVyYXRlVHlwZU5hbWU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICB2YXIgY29sbGVjdGlvbiA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWNvbGxlY3Rpb24nKTtcbiAgICB2YXIgZG9jdW1lbnRfaWQgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1kb2N1bWVudF9pZCcpO1xuICAgIHZhciBuYW1lID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ25hbWUnKTtcbiAgICBcbiAgICByZXR1cm4gY3JkdC5nZW5lcmF0ZUlEKGNvbmZpZy5vcmdhbml6YXRpb25fSWQsIGNvbGxlY3Rpb24sIGRvY3VtZW50X2lkLCBuYW1lKTtcbiAgfSxcbiAgXG4gIHNldFRleHQ6IGZ1bmN0aW9uKGVsZW1lbnRfaWQsIGluZm8pIHtcbiAgICB2YXIgcG9zID0gMDtcbiAgICB2YXIgZmxhZyA9IHRydWU7XG4gICAgXG4gICAgaW5mby5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgaWYgKGl0ZW0ucmV0YWluKSB7XG4gICAgICAgIGZsYWcgPSB0cnVlO1xuICAgICAgICBwb3MgPSBpdGVtLnJldGFpbjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKGl0ZW0uaW5zZXJ0IHx8IGl0ZW0uZGVsZXRlKSB7XG4gICAgICAgIGlmIChmbGFnID09IGZhbHNlKSBwb3MgPSAwO1xuICAgICAgICBmbGFnID0gZmFsc2U7XG4gICAgICAgIFxuICAgICAgICBpZiAoaXRlbS5pbnNlcnQpIHtcbiAgICAgICAgICAvLy4gaW5zZXJ0IHByb2Nlc3NcbiAgICAgICAgICB0aGlzLnJlY2VpdmVDaGFuZ2VEYXRhKGVsZW1lbnRfaWQsIGl0ZW0uaW5zZXJ0LCBwb3MsIHBvcylcbiAgICAgICAgfSBlbHNlIGlmIChpdGVtLmRlbGV0ZSkge1xuICAgICAgICAgIC8vLiBkZWxldGUgcHJvY2Vzc1xuICAgICAgICAgIHRoaXMucmVjZWl2ZUNoYW5nZURhdGEoZWxlbWVudF9pZCwgXCJcIiwgcG9zLCBwb3MgKyBpdGVtLmRlbGV0ZSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICB9XG4gICAgfSlcbiAgfSxcbiAgXG4gIGlzQXZhaWFibGVFbDogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIC8vY29uc29sZS5sb2codGhpcy5lbGVtZW50cylcbiAgICBcbiAgICBmb3IgKHZhciAgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zb2xlLmxvZyh0aGlzLmVsZW1lbnRzW2ldLmlzRXF1YWxOb2RlKGVsZW1lbnQpLGVsZW1lbnQpXG4gICAgICBpZiAodGhpcy5lbGVtZW50c1tpXS5pc0VxdWFsTm9kZShlbGVtZW50KT09PXRydWUpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcbiAgXG4gIHNlbmRQb3NpdGlvbjogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIC8vY29uc29sZS5sb2coXCJTZSBlbnZpbyBcIilcbiAgICAvKmlmICghdGhpcy5pc0F2YWlhYmxlRWwoZWxlbWVudCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9Ki9cbiAgICBcbiAgICBjb25zdCBpZCA9IHRoaXMuZ2VuZXJhdGVUeXBlTmFtZShlbGVtZW50KTtcbiAgICAvL2NvbnNvbGUubG9nKFwiIFNFbmQgUG9zaXRpb24gU2VsZWN0b3IgSUQgXCIsaWQpXG4gICAgLy9jb25zb2xlLmxvZyhlbGVtZW50LnNlbGVjdGlvblN0YXJ0LCBlbGVtZW50LnNlbGVjdGlvbkVuZCk7XG4gICAgbGV0IGZyb20gPSBlbGVtZW50LnNlbGVjdGlvblN0YXJ0O1xuICAgIGxldCB0byA9IGVsZW1lbnQuc2VsZWN0aW9uRW5kO1xuICAgIC8vY29uc29sZS5sb2coXCJTZSBlbnZpbyBsYSBwb3NpdGlvbiBcIixpZCxmcm9tLCB0bylcbiAgICBjcmR0LnNldFBvc2l0aW9uWUpTKGlkLCBmcm9tLCB0byk7XG4gICAgXG4gIH1cbn1cblxuXG5Db0NyZWF0ZVRleHQuaW5pdCgpO1xuLy8gQ29DcmVhdGVJbml0LnJlZ2lzdGVyKCdDb0NyZWF0ZVRleHQnLCBDb0NyZWF0ZVRleHQsIENvQ3JlYXRlVGV4dC5pbml0RWxlbWVudCk7XG5cbm9ic2VydmVyLmluaXQoeyBcblx0bmFtZTogJ0NvQ3JlYXRlVGV4dENyZWF0ZScsIFxuXHRvYnNlcnZlOiBbJ3N1YnRyZWUnLCAnY2hpbGRMaXN0J10sXG5cdGluY2x1ZGU6ICdbZGF0YS1jb2xsZWN0aW9uXVtkYXRhLWRvY3VtZW50X2lkXVtuYW1lXScsIFxuXHRjYWxsYmFjazogZnVuY3Rpb24obXV0YXRpb24pIHtcblx0ICBjb25zb2xlLmxvZygnY29jcmVhdGUtdGV4dCBpbml0Jylcblx0XHRDb0NyZWF0ZVRleHQuaW5pdEVsZW1lbnQobXV0YXRpb24udGFyZ2V0KVxuXHR9XG59KTtcblxub2JzZXJ2ZXIuaW5pdCh7IFxuXHRuYW1lOiAnQ29DcmVhdGVUZXh0TmFtZU9ic2VydmVyJywgXG5cdG9ic2VydmU6IFsnYXR0cmlidXRlcyddLFxuXHRhdHRyaWJ1dGVzOiBbJ25hbWUnXSxcblx0Y2FsbGJhY2s6IGZ1bmN0aW9uKG11dGF0aW9uKSB7XG5cdFx0Y29uc29sZS5sb2coJ2NoYW5nZSBjb2NyZWF0ZS10ZXh0IG5hbWUnKVxuXHRcdENvQ3JlYXRlVGV4dC5yZWZyZXNoRWxlbWVudChtdXRhdGlvbilcblx0fVxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IENvQ3JlYXRlVGV4dDsiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///../../CoCreateJS/node_modules/@cocreate/text/src/index.js\n")}}]);